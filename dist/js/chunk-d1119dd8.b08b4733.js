(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d1119dd8"],{"37d3":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"post-wrap d-flex flex-column"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 col-md-7"},[a("h3",{staticClass:"title py-3 border bg-white text-center mb-4"},[t._v(" 張貼動態 ")]),a("div",{staticClass:"rounded-card card"},[a("div",{staticClass:"card-body p-4"},[a("div",{staticClass:"mb-3"},[a("label",{staticClass:"form-label",attrs:{for:"content"}},[t._v("貼文內容")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.post.content,expression:"post.content"}],staticClass:"form-control rounded-0",attrs:{rows:"3",id:"content",placeholder:"輸入您的貼文內容"},domProps:{value:t.post.content},on:{input:function(e){e.target.composing||t.$set(t.post,"content",e.target.value)}}})]),a("input",{ref:"uploadImage",staticClass:"d-none",attrs:{type:"file",accept:"image/png, image/jpeg"},on:{change:function(e){return t.previewPicture()}}}),a("button",{staticClass:"btn bg-black text-white shadow-none py-1 mb-3",attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),t.$refs.uploadImage.click()}}},[t._v(" 上傳圖片 ")]),t.previewUrl?a("img",{staticClass:"border rounded border-dark w-100",attrs:{src:t.previewUrl}}):t._e(),t.errorMessage?a("div",{staticClass:"text-danger text-center d-block mt-3"},[a("small",{staticClass:"d-block"},[t._v(" "+t._s(t.errorMessage)+" ")])]):t._e(),a("div",{staticClass:"submit-btn-wrap mx-auto"},[a("button",{staticClass:"btn btn-secondary w-100 mt-3",attrs:{type:"button",disabled:!t.post.content},on:{click:function(e){return t.submitPost()}}},[t._v(" 送出貼文 ")])])])])]),a("div",{staticClass:"col-12 col-md-5 d-none d-md-block"},[a("Sidebar")],1),a("div",{staticClass:"d-md-none"},[a("SidebarSm")],1)]),a("loading",{attrs:{active:t.isLoading},on:{"update:active":function(e){t.isLoading=e}}})],1)},r=[],s=a("1da1"),o=(a("96cf"),a("d3b7"),a("3ca3"),a("ddb0"),a("d9e2"),a("d401"),{name:"Following",components:{Sidebar:function(){return a.e("chunk-1e767b91").then(a.bind(null,"5ea5"))},SidebarSm:function(){return a.e("chunk-70b44a3f").then(a.bind(null,"7441"))}},data:function(){return{isLoading:!1,post:{user:this.$store.state.userInfo.userId,image:"",content:""},errorMessage:"",uploadImg:null,previewUrl:null}},created:function(){},methods:{submitPost:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.isLoading=!0,e.next=4,t.uploadImage();case 4:return e.next=6,t.$api.createPost(t.post);case 6:if(a=e.sent,a.data&&"success"===a.status){e.next=9;break}throw new Error("新增貼文失敗");case 9:t.isLoading=!1,t.$router.push("/"),e.next=17;break;case 13:e.prev=13,e.t0=e["catch"](0),t.$toasted.show(e.t0.message),t.isLoading=!1;case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))()},uploadImage:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){if(t.isLoading=!0,!t.uploadImg)return e();var n=t.$store.state.token;t.isLoading=!0;var r=new FormData;r.append("image",t.uploadImg),r.append("type",""),t.axios({method:"post",url:"".concat("https://metawall-snow.herokuapp.com","/uploadImage"),data:r,headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(n)}}).then((function(a){"success"===a.data.status&&(t.post.image=a.data.data.imgUrl,t.isLoading=!1,e(a.data.data.imgUrl))}))["catch"]((function(e){t.$toasted.show(e.response),t.isLoading=!1,a(e)}))})));case 1:case"end":return e.stop()}}),e)})))()},previewPicture:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==t.$refs.uploadImage.files.length){e.next=2;break}return e.abrupt("return");case 2:if(t.uploadImg=t.$refs.uploadImage.files[0],!(t.uploadImg.size/1024/1024>1)){e.next=6;break}return t.errorMessage="圖片檔案過大，僅限 1mb 以下檔案",e.abrupt("return");case 6:return a=function(){return new Promise((function(e){var a=new FileReader;a.readAsDataURL(t.uploadImg),a.onload=function(t){e(t.target.result)}}))},e.next=9,a();case 9:t.previewUrl=e.sent;case 10:case"end":return e.stop()}}),e)})))()}}}),i=o,c=(a("d22e"),a("2877")),u=Object(c["a"])(i,n,r,!1,null,"574c781a",null);e["default"]=u.exports},b1e5:function(t,e,a){},d22e:function(t,e,a){"use strict";a("b1e5")}}]);
//# sourceMappingURL=chunk-d1119dd8.b08b4733.js.map